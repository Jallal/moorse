{"ast":null,"code":"import { isNode, isMap } from '../nodes/Node.js';\nimport { Scalar } from '../nodes/Scalar.js';\nimport { resolveBlockMap } from './resolve-block-map.js';\nimport { resolveBlockSeq } from './resolve-block-seq.js';\nimport { resolveFlowCollection } from './resolve-flow-collection.js';\nfunction composeCollection(CN, ctx, token, tagToken, onError) {\n  let coll;\n  switch (token.type) {\n    case 'block-map':\n      {\n        coll = resolveBlockMap(CN, ctx, token, onError);\n        break;\n      }\n    case 'block-seq':\n      {\n        coll = resolveBlockSeq(CN, ctx, token, onError);\n        break;\n      }\n    case 'flow-collection':\n      {\n        coll = resolveFlowCollection(CN, ctx, token, onError);\n        break;\n      }\n  }\n  if (!tagToken) return coll;\n  const tagName = ctx.directives.tagName(tagToken.source, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg));\n  if (!tagName) return coll;\n  // Cast needed due to: https://github.com/Microsoft/TypeScript/issues/3841\n  const Coll = coll.constructor;\n  if (tagName === '!' || tagName === Coll.tagName) {\n    coll.tag = Coll.tagName;\n    return coll;\n  }\n  const expType = isMap(coll) ? 'map' : 'seq';\n  let tag = ctx.schema.tags.find(t => t.collection === expType && t.tag === tagName);\n  if (!tag) {\n    const kt = ctx.schema.knownTags[tagName];\n    if (kt && kt.collection === expType) {\n      ctx.schema.tags.push(Object.assign({}, kt, {\n        default: false\n      }));\n      tag = kt;\n    } else {\n      onError(tagToken, 'TAG_RESOLVE_FAILED', `Unresolved tag: ${tagName}`, true);\n      coll.tag = tagName;\n      return coll;\n    }\n  }\n  const res = tag.resolve(coll, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg), ctx.options);\n  const node = isNode(res) ? res : new Scalar(res);\n  node.range = coll.range;\n  node.tag = tagName;\n  if (tag?.format) node.format = tag.format;\n  return node;\n}\nexport { composeCollection };","map":{"version":3,"names":["isNode","isMap","Scalar","resolveBlockMap","resolveBlockSeq","resolveFlowCollection","composeCollection","CN","ctx","token","tagToken","onError","coll","type","tagName","directives","source","msg","Coll","constructor","tag","expType","schema","tags","find","t","collection","kt","knownTags","push","Object","assign","default","res","resolve","options","node","range","format"],"sources":["/workspaces/moorse/node_modules/yaml/browser/dist/compose/compose-collection.js"],"sourcesContent":["import { isNode, isMap } from '../nodes/Node.js';\nimport { Scalar } from '../nodes/Scalar.js';\nimport { resolveBlockMap } from './resolve-block-map.js';\nimport { resolveBlockSeq } from './resolve-block-seq.js';\nimport { resolveFlowCollection } from './resolve-flow-collection.js';\n\nfunction composeCollection(CN, ctx, token, tagToken, onError) {\n    let coll;\n    switch (token.type) {\n        case 'block-map': {\n            coll = resolveBlockMap(CN, ctx, token, onError);\n            break;\n        }\n        case 'block-seq': {\n            coll = resolveBlockSeq(CN, ctx, token, onError);\n            break;\n        }\n        case 'flow-collection': {\n            coll = resolveFlowCollection(CN, ctx, token, onError);\n            break;\n        }\n    }\n    if (!tagToken)\n        return coll;\n    const tagName = ctx.directives.tagName(tagToken.source, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg));\n    if (!tagName)\n        return coll;\n    // Cast needed due to: https://github.com/Microsoft/TypeScript/issues/3841\n    const Coll = coll.constructor;\n    if (tagName === '!' || tagName === Coll.tagName) {\n        coll.tag = Coll.tagName;\n        return coll;\n    }\n    const expType = isMap(coll) ? 'map' : 'seq';\n    let tag = ctx.schema.tags.find(t => t.collection === expType && t.tag === tagName);\n    if (!tag) {\n        const kt = ctx.schema.knownTags[tagName];\n        if (kt && kt.collection === expType) {\n            ctx.schema.tags.push(Object.assign({}, kt, { default: false }));\n            tag = kt;\n        }\n        else {\n            onError(tagToken, 'TAG_RESOLVE_FAILED', `Unresolved tag: ${tagName}`, true);\n            coll.tag = tagName;\n            return coll;\n        }\n    }\n    const res = tag.resolve(coll, msg => onError(tagToken, 'TAG_RESOLVE_FAILED', msg), ctx.options);\n    const node = isNode(res)\n        ? res\n        : new Scalar(res);\n    node.range = coll.range;\n    node.tag = tagName;\n    if (tag?.format)\n        node.format = tag.format;\n    return node;\n}\n\nexport { composeCollection };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}